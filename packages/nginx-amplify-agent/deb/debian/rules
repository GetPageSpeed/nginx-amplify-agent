#!/usr/bin/make -f

INSTALLDIR = $(CURDIR)/debian/nginx-amplify-agent

%:
	dh $@ --with python3

override_dh_auto_build:
	python3 -m pip install --upgrade --target=amplify --no-compile -r %%REQUIREMENTS%%
	python3 setup.py build

override_dh_auto_install:
	python3 setup.py install --prefix=/usr --install-scripts=/usr/bin --root=$(INSTALLDIR) --no-compile

override_dh_installinit:
	dh_installinit -pnginx-amplify-agent --no-stop-on-upgrade --no-start --name=amplify-agent -- defaults 99 01

override_dh_installsystemd:
	dh_installsystemd -pnginx-amplify-agent --name=amplify-agent --no-start amplify-agent.service

override_dh_auto_test:
	# Skip tests

override_dh_auto_clean:
	rm -rf build
	rm -rf *.egg-info
	find amplify/ -mindepth 1 -maxdepth 1 -type d -not -name agent -and -not -name ext -exec rm -rf {} \; 2>/dev/null || true
